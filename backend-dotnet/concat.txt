WordsController.cs
using Models;
using Microsoft.AspNetCore.Mvc;
using Utils;
using System.Diagnostics;
using Microsoft.AspNetCore.Authorization;

namespace Controllers
{
    [ApiController]
    [Route("api/[controller]")] 
    public class WordsController : ControllerBase
    {
        private readonly WordsService _service;

        public WordsController(WordsService service)
        {
            _service = service;
        }

        // GET api/words?word=&userId=&pageIndex=&pageSize=&language=
        [HttpGet]
        [Authorize] //Error 401 Unauthorized
        public async Task<ApiResponse<List<Words>>> Get(
            [FromQuery] string? word = null,
            [FromQuery] string? userId = null,
            [FromQuery] int pageIndex = 1,
            [FromQuery] int pageSize = 20,
            [FromQuery] string language = "en")
        {
            return await _service.GetAsync(word, pageIndex, pageSize, userId);
        }

        // POST api/words
        [HttpPost]
        public async Task<ApiResponse<Words>> Add([FromBody] Words record, [FromQuery] string language = "en")
        {
            return await _service.AddAsync(record, language);
        }

        // PUT api/words
        [HttpPut]
        public async Task<ApiResponse<Words>> Update([FromBody] Words record, [FromQuery] string language = "en")
        {
            return await _service.UpdateAsync(record, language);
        }

        // DELETE api/words/{id}?language=
        [HttpDelete("{id}")]
        public async Task<ApiResponse<bool>> Delete(int id, [FromQuery] string language = "en")
        {
            return await _service.DeleteAsync(id, language);
        }
    }
}


WordsService.cs
using Microsoft.EntityFrameworkCore;
using Models;
using Utils;
using static Features.WordsTranslation;
using static Utils.ApiResponse<Models.Words>;

public class WordsService
{
    private readonly AppDbContext _context;

    public WordsService(AppDbContext context)
    {
        _context = context;
    }

    public async Task<ApiResponse<List<Words>>> GetAsync(
        string? word = null,
        int pageIndex = 1,
        int pageSize = 20,
        string? userId = null)
    {
        var query = _context.Words.AsQueryable();

        if (!string.IsNullOrWhiteSpace(word))
            query = query.Where(w => w.Word.ToLower().Contains(word.ToLower()));

        if (!string.IsNullOrWhiteSpace(userId))
            query = query.Where(w => w.UserId == userId);

        query = query
            .Skip((pageIndex - 1) * pageSize)
            .Take(pageSize);

        var data = await query.ToListAsync();

        return ApiResponse<List<Words>>.Ok(data);
    }

    public async Task<ApiResponse<Words>> AddAsync(Words record, string language = "en")
    {

        if (string.IsNullOrWhiteSpace(record.Word))
            return Fail(ErrorWordEmpty, language);

        if (string.IsNullOrWhiteSpace(record.UserId))
            return Fail(ErrorUserIdEmpty, language);

        var existing = await _context.Words
            .FirstOrDefaultAsync(e => e.Word == record.Word && e.UserId == record.UserId);

        if (existing != null)
            return Fail(ErrorDuplicateWord, language);

        _context.Words.Add(record);
        await _context.SaveChangesAsync();
        return Ok(record);

    }

    public async Task<ApiResponse<Words>> UpdateAsync(Words record, string language = "en")
    {
        if (string.IsNullOrWhiteSpace(record.Id))
            return Fail(ErrorIdEmpty, language);

        if (string.IsNullOrWhiteSpace(record.Word))
            return Fail(ErrorWordEmpty, language);

        if (string.IsNullOrWhiteSpace(record.UserId))
            return Fail(ErrorUserIdEmpty, language);

        var existing = await _context.Words
            .FirstOrDefaultAsync(e => e.Word == record.Word && e.UserId == record.UserId && e.Id != record.Id);

        if (existing != null)
            return Fail(ErrorDuplicateWord, language);

        var existingRecord = await _context.Words.FindAsync(record.Id) ?? throw new InvalidOperationException("Record not found");
        _context.Entry(existingRecord).CurrentValues.SetValues(record);
        await _context.SaveChangesAsync();
        return Ok(existingRecord);
    }

    public async Task<ApiResponse<bool>> DeleteAsync(int id, string language = "en")
    {
        var row = await _context.Words.FindAsync(id) ?? throw new InvalidOperationException("Record not found");
        _context.Words.Remove(row);
        await _context.SaveChangesAsync();
        return ApiResponse<bool>.Ok(true);
    }
}

WordsTranslation.cs
using Utils;

namespace Features
{

    public static class WordsTranslation
    {
        public static Translation ErrorWordEmpty = new Translation
        {
            VI = "Từ vựng không được để trống!",
            EN = "Word cannot be empty!"
        };

        public static Translation ErrorUserIdEmpty = new Translation
        {
            VI = "UserId không được để trống!",
            EN = "UserId cannot be empty!"
        };

        public static Translation ErrorDuplicateWord = new Translation
        {
            VI = "Từ vựng đã tồn tại!",
            EN = "This word duplicated!"
        };

        public static Translation ErrorNotExist = new Translation
        {
            VI = "Bản ghi không tồn tại!",
            EN = "Record not existed!"
        };

        public static Translation ErrorIdEmpty = new Translation
        {
            VI = "Id không được để trống!",
            EN = "Id cannot be empty!"
        };
    }
}


